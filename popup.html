<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WP Admin Menu Cleaner</title>
    <style>
      body {
        font: 13px system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        padding: 12px 14px;
        width: 220px;
      }
      label {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .row {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
    </style>
  </head>
  <body>
    <div class="row">
      <strong>Clean menu</strong>
      <label>
        <input type="checkbox" id="toggle" />
        <span id="state">Off</span>
      </label>
    </div>
    <script>
      const storageKey = "wp_admin_menu_cleaner_enabled";
      const toggle = document.getElementById("toggle");
      const state = document.getElementById("state");

      function setState(checked) {
        toggle.checked = checked;
        state.textContent = checked ? "On" : "Off";
      }

      chrome.storage.sync.get(storageKey, (res) => {
        setState(
          res && typeof res[storageKey] === "boolean" ? res[storageKey] : true
        );
      });

      toggle.addEventListener("change", async () => {
        const enabled = !!toggle.checked;
        chrome.storage.sync.set({ [storageKey]: enabled });

        // Notify the active tab (if it's a wp-admin page)
        const [tab] = await chrome.tabs.query({
          active: true,
          currentWindow: true,
        });
        if (tab && tab.id) {
          chrome.tabs.sendMessage(tab.id, {
            type: "WP_ADMIN_MENU_CLEANER_TOGGLE",
            enabled,
          });
        }
      });
    </script>
  </body>
</html>
